<td-layout-nav toolbarTitle="{{title}}" class="container">
  <button mat-icon-button td-menu-button mat-dialog-close>
    <mat-icon>arrow_back</mat-icon>
  </button>
  <div td-toolbar-content layout="row" layout-align="start center" flex>
    <!--<span flex></span>-->
    <!--<td-search-box #searchBox (keyup)='updateFilter($event)' (clear)="updateFilter('')" backIcon="search"-->
    <!--class="btn-icon" placeholder="Filter by any keyword" flex>-->
    <!--</td-search-box>-->

    <!--<span>-->
    <!--<a mat-icon-button mat-tooltip="History" class="btn-icon push-right-sm" (click)="openLogs(null)"><mat-icon>history</mat-icon></a>-->
    <!--</span>-->
  </div>

  <td-layout-card-over cardTitle="" cardSubtitle="">
    <mat-card-title>
      <div layout="row" layout-align="start end" flex>
        {{data.code}}
        <span flex></span>
        <button mat-button class="text-upper" mat-dialog-close>
          <mat-icon>cancel</mat-icon> Cancel</button>
        <button mat-button class="text-upper" color="primary" (click)="saveData(form)">
          <mat-icon>save</mat-icon> Save</button>
      </div>
    </mat-card-title>

    <mat-divider></mat-divider>

    <mat-card-content class="push-bottom-none">
      <div layout="row" layout-align="start center">
        <mat-card-content class="push-buttom-none" style="width: 25vw;margin: 10px; background-color: #f5f5f5;">
          <div layout="row">
            <mat-form-field style="padding: 0px 10px;" flex>
              <input matInput
                     readonly
                     name="document_date"
                     [ngModel]="data.document_date | date:'dd/MM/yyyy'"
                     placeholder="Document Date" flex>
            </mat-form-field>
          </div>

          <div layout="row">
            <mat-form-field style="padding: 0px 10px;" flex>
              <input matInput
                     readonly
                     name="delivery_date"
                     [ngModel]="data.delivery_date | date:'dd/MM/yyyy'"
                     (ngModelChange)="data.delivery_date = $event"
                     placeholder="Delivery Date" flex>
              <input matInput
                     [matDatepicker]="delivery_date_datepicker"
                     style="display: none;"
                     (dateChange)="data.delivery_date = delivery_date_datepicker._selected.getTime()">
              <mat-datepicker-toggle matSuffix [for]="delivery_date_datepicker" style="font-size: 20px;"></mat-datepicker-toggle>
              <mat-datepicker #delivery_date_datepicker></mat-datepicker>
            </mat-form-field>
          </div>
        </mat-card-content>

        <mat-card-content class="push-bottom-none" style="width: 75vw">
          <div layout="row">
            <mat-form-field style="padding: 0px 10px;" flex>
              <mat-select placeholder="Type"
                          #typeControl="ngModel"
                          [ngModelOptions]="{standalone: true}"
                          (change)="getItemGroupData(data.type)"
                          [(ngModel)]="data.type">
                <mat-option *ngFor="let type of types" [value]="type.code">{{type.code}} : {{type.name1}}</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field style="padding: 0px 10px;" flex>
              <mat-select placeholder="Group"
                          #groupControl="ngModel"
                          [ngModelOptions]="{standalone: true}"
                          (change)="getItemSubGroupData(data.group)"
                          [(ngModel)]="data.group">
                <mat-option *ngFor="let group of groups" [value]="group.code">{{group.code}} : {{group.name1}}</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field style="padding: 0px 10px;" flex>
              <mat-select placeholder="Sub Group"
                          #subgroupControl="ngModel"
                          [ngModelOptions]="{standalone: true}"
                          [(ngModel)]="data.subgroup">
                <mat-option *ngFor="let subgroup of subgroups" [value]="subgroup.code">{{subgroup.code}} : {{subgroup.name1}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div layout="row">
            <mat-form-field style="padding: 0px 10px;" flex>
              <mat-select placeholder="Supplier"
                          #typeControl="ngModel"
                          [ngModelOptions]="{standalone: true}"
                          [(ngModel)]="data.supplier">
                <mat-option *ngFor="let supplier of suppliers" [value]="supplier.code">{{supplier.code}} : {{supplier.name1}}</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field style="padding: 0px 10px;" flex>
              <mat-select placeholder="VAT Type"
                          #subgroupControl="ngModel"
                          [ngModelOptions]="{standalone: true}"
                          [(ngModel)]="data.vat_type" (change)="sumaryTotal()">
                <mat-option *ngFor="let vat_type of vat_types" [value]="vat_type.code">{{vat_type.name}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div layout="row">
            <mat-form-field style="padding: 0px 10px;" flex>
            <textarea matInput
                      #remarkElement
                      #remarkControl="ngModel"
                      placeholder="Remark"
                      [(ngModel)]="data.remark"
                      name="remark"
                      maxlength="250" style="height: 50px;"></textarea>
              <mat-hint align="start">
              </mat-hint>
              <mat-hint align="end">{{remarkElement.value?.length || 0}} / 250</mat-hint>
            </mat-form-field>
          </div>
        </mat-card-content>
      </div>
    </mat-card-content>

    <mat-divider style="margin: 0px 10px;"></mat-divider>

    <mat-card-actions>
      <div layout="row" layout-align="start center" flex>
        <button mat-button class="text-upper" color="primary" (click)="loadItemData(data)">
          <mat-icon>get_app</mat-icon> Load Item</button>
        <!--<button mat-button class="text-upper" color="warn" (click)="deleteItemData()">
          <mat-icon>delete_forever</mat-icon> Delete</button>-->
        <!--<span flex></span>-->
        <td-search-box #searchBox (keyup)='updateFilter($event)' (clear)="updateFilter('')" backIcon="arrow_back"
                       class="btn-icon" placeholder="Filter by any keyword" [alwaysVisible]="true" flex>
        </td-search-box>
      </div>
    </mat-card-actions>

    <mat-card-content>
      <ngx-datatable
        #dataTable
        class="data-table"
        [rows]="data.item"
        [columnMode]="'force'"
        [headerHeight]="35"
        [scrollbarH]="true"
        [rowHeight]="'auto'"
        [sorts]="[{prop: 'prop', dir: 'desc'}]"
        [limit]="page.size"
      >

        <ngx-datatable-column [sortable]="false" name="No." width="50">
          <ng-template let-rowIndex="rowIndex" let-row="row" ngx-datatable-cell-template>
            <div style="text-align: left" class="text-truncate">
              {{rowIndex+1}}.
            </div>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          prop="code"
          name="Code"
          [minWidth]="75">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <div style="text-align: left" class="text-truncate">
              {{row.code}}
            </div>
          </ng-template>
        </ngx-datatable-column>


        <ngx-datatable-column
          [canAutoResize]="true"
          prop="name"
          name="Description">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <div fxLayout="column">
              <div [ngClass]="{'twoline-title': row.name1}" style="text-align: left;padding-bottom: 0px;"
                   class="text-truncate">
                {{row.name1}}
              </div>
              <div *ngIf="row.name1" class="text-truncate"
                   style="padding-top: 5px;text-align: left;line-height: 5px;font-size: 0.7rem;opacity: 0.8;">
                {{row.name2}}
              </div>
            </div>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [width]="75"
          [minWidth]="50"
          prop="quantity"
          name="Quantity">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <mat-form-field style="max-width: 75%;">
              <input matInput
                     #quantityElement
                     #quantityControl="ngModel"
                     [(ngModel)]="row.quantity"
                     style="text-align: end;"
                     name="quantity"
                     type="number"
                     maxlength="8"
                     (change)="calAmount(row)">
            </mat-form-field>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [width]="75"
          [minWidth]="50"
          prop="price"
          name="Price">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <mat-form-field style="max-width: 75%;">
              <input matInput
                     #priceElement
                     #priceControl="ngModel"
                     [(ngModel)]="row.price"
                     style="text-align: end;"
                     name="price"
                     type="number"
                     maxlength="8"
                     (change)="calAmount(row)">
            </mat-form-field>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [width]="125"
          [minWidth]="75"
          prop="unit"
          name="Unit">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <mat-form-field style="max-width: 75%;">
              <mat-select #unitControl="ngModel"
                          [ngModelOptions]="{standalone: true}"
                          [(ngModel)]="row.unit">
                <mat-option [value]="row.primary_unit" *ngIf="row.primary_unit">{{row.primary_unit}} : {{row.primary_unit_name}}</mat-option>
                <mat-option [value]="row.secondary_unit" *ngIf="row.secondary_unit">{{row.secondary_unit}} : {{row.secondary_unit_name}}</mat-option>
              </mat-select>
            </mat-form-field>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [width]="75"
          [minWidth]="50"
          prop="discount"
          name="Discount">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <mat-form-field style="max-width: 75%;">
              <input matInput
                     #discountElement
                     #discountControl="ngModel"
                     [(ngModel)]="row.discount"
                     style="text-align: end;"
                     name="discount"
                     type="number"
                     maxlength="8"
                     (change)="calAmount(row)">
            </mat-form-field>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [width]="75"
          [minWidth]="50"
          prop="amount"
          name="Amount">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <mat-form-field style="max-width: 75%;">
              <input matInput
                     #amountElement
                     #amountControl="ngModel"
                     [(ngModel)]="row.amount"
                     style="text-align: end;"
                     name="amount"
                     type="number"
                     maxlength="8"
                     readonly>
            </mat-form-field>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [canAutoResize]="false"
          [resizeable]="false"
          [width]="75">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <div style="text-align: center;" fxLayout="row">
              <button mat-icon-button mat-tooltip="Delete" color="warn" class="" (click)="deleteItemData(row)">
                <mat-icon>delete_forever</mat-icon>
              </button>
            </div>
          </ng-template>
        </ngx-datatable-column>
      </ngx-datatable>

      <div class="mat-padding" *ngIf="data.item?.length === 0" layout="row" layout-align="center center">
        <h3>No data to display.</h3>
      </div>

      <mat-paginator #paginator
                     [length]="page.totalElements"
                     [pageIndex]="page.pageNumber"
                     [pageSize]="page.size"
                     (page)="setPage($event)"
                     [pageSizeOptions]="[25, 50, 100, 250]" flex>
      </mat-paginator>
    </mat-card-content>
  </td-layout-card-over>
</td-layout-nav>
